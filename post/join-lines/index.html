<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">


        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" integrity="sha384-WskhaSGFgHYWDcbwN70/dfYBj47jz9qbsMId/iRN3ewGhXQFZCSftd1LZCfmhktB" crossorigin="anonymous">

        <link href="https://fonts.googleapis.com/css?family=Ubuntu|Ubuntu+Mono" rel="stylesheet">

        <title>Join lines, vi-style in Emacs</title>

        <link rel="stylesheet" href="/css/stylesheet.css">
    </head>
    <body>
      <div class="container-fluid">
        <nav class="navbar navbar-expand-md navbar-light">


          <span class="navbar-brand mb-0 h1"></span>

          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle Navigation" name="button">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link " href="/">Home</a>
              <a class="nav-item nav-link" href="https://github.com/julienchastang" target="_blank">GitHub</a>
              <a class="nav-item nav-link" href="https://github.com/julienchastang/dotemacs" target="_blank">Emacs</a>

              <a class="nav-item nav-link " href="/about/">About</a>
            </div>
          </div>
        </nav>

        <section id="page-title">
          <h1><a href="/"> </a></h1>
          <span id="author-name">
            <h6><a href="/about/"></a></h6>
          </span>
        </section>


<div class="blog-post">
  <h1>Join lines, vi-style in Emacs</h1>
  <div class="blog-post-subheader">
    <time>18 Oct 2019</time>
  </div>
  <div class="blog-post-content">
    <p>I mostly edit in Emacs but occasionally I like to use vi. vi is often the only editor available in certain computing environments. In Emacs, I find myself missing vi&rsquo;s join line capability. Emacs&rsquo; closest equivalent is <code>M-^</code> or the unintuitively named  <code>delete-indentation</code> function. <code>M-^</code> is awkward in that it joins the current line to the previous line. This behavior feels unnatural especially when joining many lines in succession where you have to go to the end of the block you want to join and repeatedly type <code>M-^</code>.</p>

<p>Instead, we can write an Emacs keyboard macro to mimic the vi join line capability. I followed Mike Zamansky&rsquo;s <a href="https://youtu.be/Y1oVNBuIoXo">video</a> on how to write macros. He also has a <a href="https://youtu.be/49kBWM3RQQ8">great YouTube channel on emacs</a>, by the way. Start &ldquo;recording&rdquo; the macro with <code>C-x (</code>  and end it with <code>C-x )</code>. This terminal session in the emacs <code>*scratch*</code> buffer should give you an idea of how I created the macro.</p>

<script id="asciicast-275378" src="https://asciinema.org/a/275378.js" async></script>

<p>Name the macro you just created with <code>M-x kmacro-name-last-macro</code>. Here, I named it <code>jc/join-lines</code>. Capture the emacs-lisp with <code>M-x insert-kbd-macro</code> which may yield:</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(<span style="color:#00a000">fset</span> <span style="color:#b8860b">&#39;jc/join-lines</span>
      (<span style="color:#a2f">lambda</span> (<span style="color:#a2f">&amp;optional</span> <span style="color:#b8860b">arg</span>) <span style="color:#b44">&#34;Keyboard macro.&#34;</span> (<span style="color:#a2f">interactive</span> <span style="color:#b44">&#34;p&#34;</span>)
        (<span style="color:#b8860b">kmacro-exec-ring-item</span> (<span style="color:#a2f">quote</span> (<span style="color:#b44">&#34;^N^A^? ^B&#34;</span> <span style="color:#666">0</span> <span style="color:#b44">&#34;%d&#34;</span>)) <span style="color:#b8860b">arg</span>)))</code></pre></div>
<p>or</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(<span style="color:#00a000">fset</span> <span style="color:#b8860b">&#39;jc/join-lines</span>
      (<span style="color:#a2f">lambda</span> (<span style="color:#a2f">&amp;optional</span> <span style="color:#b8860b">arg</span>) <span style="color:#b44">&#34;Keyboard macro.&#34;</span> (<span style="color:#a2f">interactive</span> <span style="color:#b44">&#34;p&#34;</span>)
        (<span style="color:#b8860b">kmacro-exec-ring-item</span> (<span style="color:#a2f">quote</span> ([<span style="color:#666">14</span> <span style="color:#666">1</span> <span style="color:#b8860b">backspace</span> <span style="color:#666">32</span> <span style="color:#666">2</span>] <span style="color:#666">0</span> <span style="color:#b44">&#34;%d&#34;</span>)) <span style="color:#b8860b">arg</span>)))</code></pre></div>
<p>depending on your emacs terminal environment. In my situation, iTerm created the former and X11 the latter.</p>

<p>Note in the first code snippet, those are control characters in the quoted region (e.g., next line, beginning of line, etc.), not caret N, etc. If you simply try to copy/paste this snippet, it will not work as intended. It is best to create the macro as described here to properly capture your intention.</p>

<p>Finally, let&rsquo;s create a global key binding.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(<span style="color:#b8860b">global-set-key</span> (<span style="color:#b8860b">kbd</span> <span style="color:#b44">&#34;C-c j&#34;</span>) <span style="color:#b8860b">&#39;jc/join-lines</span>)</code></pre></div>
<p>You can put these snippets of emacs-lisp in your emacs initialization file to always have this macro available.</p>

  </div>
</div>

      <footer>
        <hr>
        <small>
          &copy; 2019 .
          <a href="https://github.com/julienchastang/julienchastang.com" target="_blank">Source</a>.
          Powered by <a href="https://ox-hugo.scripter.co/" target="_blank">ox-hugo</a>, <a href="https://gohugo.io/" target="_blank">Hugo</a> using the <a href="https://github.com/arjunkrishnababu96/basics" target="_blank">Basics</a> theme.
        </small>
      </footer>
    </div>


    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
  </body>
</html>

